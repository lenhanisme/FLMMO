<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLMMO.VN - SMM Panel</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { brand: { 500: '#22c55e', 600: '#16a34a' } }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .menu-item.active { background-color: #f1f5f9; color: #16a34a; border-right: 3px solid #16a34a; }
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-gray-800 relative">

    <!-- MOBILE OVERLAY -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden transition-opacity" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="fixed md:relative inset-y-0 left-0 transform -translate-x-full md:translate-x-0 w-64 bg-white border-r border-gray-200 flex flex-col z-40 transition-transform duration-300 ease-in-out">
        <!-- Favicon/Logo Area -->
        <div class="h-16 flex items-center justify-center border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition" onclick="switchView('order')">
            <span class="text-2xl font-bold tracking-tight text-gray-900">
                FL<span class="text-brand-600">MMO.VN</span>
            </span>
        </div>

        <!-- Menu Navigation -->
        <div class="flex-1 overflow-y-auto py-4">
            <div class="px-4 mb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">B·∫£ng ƒêi·ªÅu Khi·ªÉn</div>
            <ul>
                <li><a href="#" id="menu-order" class="menu-item flex items-center px-6 py-3 text-sm hover:bg-gray-50 transition" onclick="switchView('order')"><i class="fa-solid fa-cart-plus w-6"></i> ƒê·∫∑t ƒê∆°n M·ªõi</a></li>
                <li><a href="#" id="menu-history" class="menu-item flex items-center px-6 py-3 text-sm hover:bg-gray-50 transition" onclick="switchView('history')"><i class="fa-solid fa-list-rotate w-6"></i> L·ªãch S·ª≠ ƒê∆°n</a></li>
                <li><a href="#" id="menu-deposit" class="menu-item flex items-center px-6 py-3 text-sm hover:bg-gray-50 transition" onclick="switchView('deposit')"><i class="fa-solid fa-wallet w-6"></i> N·∫°p Ti·ªÅn <span class="ml-auto bg-red-100 text-red-600 text-[10px] px-2 py-0.5 rounded-full font-bold animate-pulse">HOT</span></a></li>
            </ul>

            <div class="px-4 mt-6 mb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">D·ªãch V·ª• C·ªßa B·∫°n</div>
            <ul>
                <li>
                    <button class="w-full flex items-center justify-between px-6 py-3 text-sm text-brand-600 bg-green-50 font-medium border-l-2 border-brand-500">
                        <span class="flex items-center"><i class="fa-brands fa-facebook w-6 text-blue-600"></i> Facebook</span>
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </button>
                    <ul class="bg-white py-1">
                        <li><a href="#" class="flex items-center pl-12 pr-6 py-2.5 text-sm hover:text-brand-600 hover:bg-gray-50" onclick="loadServiceForm('TƒÉng B√¨nh Lu·∫≠n FB')"><i class="fa-solid fa-bolt text-yellow-500 mr-2"></i> TƒÉng B√¨nh Lu·∫≠n</a></li>
                        <li><a href="#" class="flex items-center pl-12 pr-6 py-2.5 text-sm hover:text-brand-600 hover:bg-gray-50" onclick="loadServiceForm('TƒÉng Like FB')"><i class="fa-solid fa-thumbs-up text-blue-500 mr-2"></i> TƒÉng Like / C·∫£m X√∫c</a></li>
                        <li><a href="#" class="flex items-center pl-12 pr-6 py-2.5 text-sm hover:text-brand-600 hover:bg-gray-50" onclick="loadServiceForm('TƒÉng Follow FB')"><i class="fa-solid fa-user-plus text-green-500 mr-2"></i> TƒÉng Follow/Sub</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- User Profile Card Sidebar -->
        <div class="p-4 border-t border-gray-100 bg-green-50/50 m-2 rounded-xl cursor-pointer hover:bg-green-100 transition" onclick="toggleModal('modal-profile')">
            <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full bg-brand-500 flex items-center justify-center text-white font-bold mb-2 shadow" id="ui-avatar">U</div>
                <div class="text-sm font-semibold text-gray-800" id="ui-fullname">ƒêang t·∫£i...</div>
                <div class="bg-white px-3 py-1 mt-2 rounded-full text-xs font-bold text-brand-600 shadow-sm border border-brand-100" id="ui-coin">... VNƒê</div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden bg-[#f4f7fb]">
        
        <!-- HEADER -->
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 sm:px-6 z-10 shadow-sm shrink-0">
            <div class="flex items-center gap-2 sm:gap-3">
                <button onclick="toggleSidebar()" class="md:hidden text-gray-500 hover:text-gray-800 p-1">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <h1 id="header-title" class="text-base sm:text-lg font-bold text-gray-800 border-l-4 border-brand-500 pl-2 truncate max-w-[160px] sm:max-w-none">Ch√†o m·ª´ng tr·ªü l·∫°i!</h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-sm text-gray-500 hidden sm:block"><i class="fa-solid fa-circle text-[8px] text-brand-500 animate-pulse mr-1"></i> H·ªá th·ªëng ·ªïn ƒë·ªãnh</div>
                <button onclick="toggleModal('modal-profile')" class="w-9 h-9 rounded-full bg-brand-500 flex items-center justify-center text-white font-bold text-sm shadow cursor-pointer hover:scale-105 transition" id="ui-avatar-small" title="Th√¥ng tin t√†i kho·∫£n">
                    U
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 sm:p-6">
            
            <!-- VIEW 1: ƒê·∫∂T ƒê∆†N (ORDER) -->
            <div id="view-order" class="view-section active max-w-7xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <form id="form-order">
                            <div class="mb-5">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Link Ho·∫∑c UID c·∫ßn tƒÉng:</label>
                                <input type="text" id="order-link" placeholder="Nh·∫≠p link ho·∫∑c ID ƒë·ªÉ ch·∫°y" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition disabled:bg-gray-100 disabled:cursor-not-allowed" disabled required>
                            </div>
                            <div class="mb-5">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ch·ªçn m√°y ch·ªß x·ª≠ l√Ω:</label>
                                <!-- Khu v·ª±c render danh s√°ch m√°y ch·ªß -->
                                <div id="server-list" class="space-y-3">
                                    <div class="p-6 border border-dashed border-gray-300 rounded-lg text-center text-sm text-gray-500 bg-gray-50">
                                        <i class="fa-solid fa-hand-pointer mb-3 text-gray-400 text-2xl"></i><br>
                                        Vui l√≤ng ch·ªçn m·ªôt lo·∫°i d·ªãch v·ª• t·ª´ Menu b√™n tr√°i <br>(VD: TƒÉng B√¨nh Lu·∫≠n, TƒÉng Like...)
                                    </div>
                                </div>
                            </div>
                            <div class="mb-5">
                                <label class="block text-sm font-medium text-gray-700 mb-2">S·ªë l∆∞·ª£ng c·∫ßn tƒÉng:</label>
                                <input type="number" id="qty" value="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 disabled:text-gray-400 disabled:cursor-not-allowed outline-none focus:ring-2 focus:ring-brand-500" disabled required oninput="calcPrice()">
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-5 flex justify-between items-center">
                                <span class="text-gray-500 font-medium">T·ªïng thanh to√°n:</span>
                                <span id="total" class="text-2xl font-bold text-brand-600">0 <span class="text-sm text-gray-500">VNƒê</span></span>
                            </div>
                            <button type="submit" id="btn-create-order" class="w-full bg-gray-300 text-white font-bold py-3 rounded-lg cursor-not-allowed transition duration-300 flex justify-center items-center" disabled>
                                <span>T·∫°o ƒê∆°n H√†ng</span>
                            </button>
                            <div id="order-status-msg" class="hidden text-sm mt-3 text-center p-3 rounded font-medium"></div>
                        </form>
                    </div>

                    <!-- H∆∞·ªõng d·∫´n Panel -->
                    <div class="space-y-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl shadow-md p-6 text-sm">
                            <h4 class="font-bold text-lg mb-4 flex items-center"><i class="fa-solid fa-circle-info mr-2"></i> L∆∞u √Ω quan tr·ªçng</h4>
                            <ul class="space-y-3 opacity-90">
                                <li><i class="fa-solid fa-caret-right mr-1"></i> Ki·ªÉm tra k·ªπ ƒë·ªãnh d·∫°ng Link/UID tr∆∞·ªõc khi l√™n ƒë∆°n.</li>
                                <li><i class="fa-solid fa-caret-right mr-1"></i> ƒê·∫£m b·∫£o t√†i kho·∫£n / b√†i vi·∫øt ·ªü ch·∫ø ƒë·ªô c√¥ng khai.</li>
                                <li><i class="fa-solid fa-caret-right mr-1"></i> Kh√¥ng ƒë·∫∑t 2 ƒë∆°n c√πng l√∫c cho 1 Link n·∫øu ƒë∆°n c≈© ch∆∞a xong.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: L·ªäCH S·ª¨ ƒê∆†N (HISTORY) -->
            <div id="view-history" class="view-section max-w-7xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                        <h2 class="text-lg font-bold text-gray-800">L·ªãch S·ª≠ Mua D·ªãch V·ª•</h2>
                        <div class="flex items-center gap-2">
                            <button onclick="loadOrderHistory()" class="text-sm text-gray-500 hover:text-brand-600 border border-gray-200 px-3 py-1.5 rounded-lg"><i class="fa-solid fa-rotate mr-1"></i> L√†m m·ªõi</button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left">
                            <thead class="text-xs text-gray-500 uppercase bg-gray-50 border-y border-gray-200">
                                <tr>
                                    <th class="px-4 py-3">M√£ ƒë∆°n</th>
                                    <th class="px-4 py-3">Lo·∫°i d·ªãch v·ª•</th>
                                    <th class="px-4 py-3">M√°y ch·ªß</th>
                                    <th class="px-4 py-3">Link/UID</th>
                                    <th class="px-4 py-3">S·ªë l∆∞·ª£ng</th>
                                    <th class="px-4 py-3">T·ªïng ti·ªÅn</th>
                                    <th class="px-4 py-3">Tr·∫°ng th√°i</th>
                                </tr>
                            </thead>
                            <tbody id="order-history-body">
                                <tr>
                                    <td colspan="7" class="px-4 py-12 text-center text-gray-500">
                                        <div class="flex flex-col items-center justify-center">
                                            <i class="fa-solid fa-folder-open text-4xl text-gray-300 mb-3"></i>
                                            <p>Ch∆∞a c√≥ giao d·ªãch n√†o ƒë∆∞·ª£c ghi nh·∫≠n</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: N·∫†P TI·ªÄN (DEPOSIT) -->
            <div id="view-deposit" class="view-section max-w-7xl mx-auto space-y-6">
                <!-- Th√¥ng tin chuy·ªÉn kho·∫£n -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col md:flex-row gap-8">
                    <!-- C·ªôt QR Code -->
                    <div class="md:w-1/3 flex flex-col items-center bg-[#f8fafc] p-6 rounded-xl border border-dashed border-gray-300">
                        <div class="bg-white p-2 rounded-xl shadow-sm border border-gray-100 mb-4">
                            <img id="qr-image" src="https://qr.sepay.vn/img?acc=4477040408&bank=MBBank&amount=&des=&template=compact" class="w-full max-w-[220px] rounded-lg transition-all" alt="QR Code N·∫°p Ti·ªÅn">
                        </div>
                        <p class="text-xs text-gray-500 text-center font-medium"><i class="fa-solid fa-qrcode mr-1"></i> M·ªü App Ng√¢n h√†ng qu√©t m√£ ƒë·ªÉ chuy·ªÉn nhanh</p>
                    </div>

                    <!-- C·ªôt Chi ti·∫øt -->
                    <div class="md:w-2/3 flex flex-col justify-center space-y-5">
                        <h3 class="text-xl font-bold text-gray-800 border-l-4 border-brand-500 pl-3">Th√¥ng Tin Nh·∫≠n Ti·ªÅn</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 text-sm">
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                <p class="text-gray-500 mb-1 text-xs uppercase tracking-wider">Ng√¢n h√†ng th·ª• h∆∞·ªüng</p>
                                <div class="flex items-center font-bold text-gray-800 text-lg">
                                    <img src="https://my.sepay.vn/assets/images/banklogo/mbbank-icon.png" class="h-6 w-auto mr-2" alt="MBBank Logo"> MBBANK
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                <p class="text-gray-500 mb-1 text-xs uppercase tracking-wider">Ch·ªß t√†i kho·∫£n</p>
                                <div class="font-bold text-gray-800 text-lg uppercase tracking-wide">LE NGOC NHAN</div>
                            </div>
                            
                            <div class="md:col-span-2 bg-blue-50/50 p-4 rounded-lg border border-blue-100">
                                <p class="text-gray-500 mb-1 text-xs uppercase tracking-wider">S·ªë t√†i kho·∫£n</p>
                                <div class="flex items-center justify-between font-bold text-blue-700 text-2xl tracking-widest">
                                    <span>4477040408</span>
                                    <button onclick="copySTK()" class="text-blue-600 bg-white hover:bg-blue-600 hover:text-white border border-blue-200 px-4 py-1.5 rounded shadow-sm text-sm transition flex items-center">
                                        <span id="btn-copy-icon"><i class="fa-regular fa-copy mr-1"></i> Copy</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Form b√°o ƒë√£ chuy·ªÉn -->
                        <div class="pt-4 border-t border-gray-100">
                            <form id="form-deposit" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">S·ªë ti·ªÅn b·∫°n n·∫°p (VNƒê) <span class="text-red-500">*</span></label>
                                        <input type="number" id="deposit-amount" required min="10000" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none transition bg-gray-50 focus:bg-white" placeholder="VD: 50000" oninput="updateQR()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">M√£ giao d·ªãch (Kh√¥ng b·∫Øt bu·ªôc)</label>
                                        <input type="text" id="deposit-transId" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none transition bg-gray-50 focus:bg-white" placeholder="VD: FT230620...">
                                    </div>
                                </div>
                                
                                <button type="submit" id="btn-submit-deposit" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3.5 rounded-lg shadow-md transition duration-300 flex justify-center items-center">
                                    T√¥i ƒë√£ chuy·ªÉn ti·ªÅn xong <i class="fa-solid fa-check-circle ml-2"></i>
                                </button>
                                <div id="deposit-status-msg" class="hidden text-sm mt-2 text-center p-2 rounded"></div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- B·∫£ng L·ªãch s·ª≠ n·∫°p -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">L·ªãch S·ª≠ N·∫°p Ti·ªÅn</h3>
                        <button onclick="loadDepositHistory()" class="text-sm text-gray-500 hover:text-brand-600 border border-gray-200 px-3 py-1.5 rounded-lg"><i class="fa-solid fa-rotate mr-1"></i> L√†m m·ªõi</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left border-y border-gray-200">
                            <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3">M√£ GD H·ªá Th·ªëng</th>
                                    <th class="px-4 py-3">S·ªë Ti·ªÅn</th>
                                    <th class="px-4 py-3">M√£ GD Ng√¢n H√†ng</th>
                                    <th class="px-4 py-3">Th·ªùi gian</th>
                                    <th class="px-4 py-3">Tr·∫°ng th√°i</th>
                                </tr>
                            </thead>
                            <tbody id="deposit-history-body">
                                <tr><td colspan="5" class="text-center py-6"><i class="fa-solid fa-circle-notch fa-spin text-gray-400"></i> ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODAL H·ªí S∆† T√ÄI KHO·∫¢N -->
    <div id="modal-profile" class="fixed inset-0 z-50 bg-gray-900/50 backdrop-blur-sm hidden flex items-center justify-center transition-opacity">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden relative transform transition-all">
            <!-- Close btn -->
            <button onclick="toggleModal('modal-profile')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-sm"><i class="fa-solid fa-xmark"></i></button>
            
            <div class="p-6 border-b border-gray-100 bg-gradient-to-r from-green-50 to-blue-50">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 rounded-full bg-brand-500 text-white flex items-center justify-center text-3xl font-bold shadow-lg border-2 border-white" id="modal-avatar">U</div>
                    <div>
                        <h3 class="font-bold text-xl text-gray-800" id="modal-name">User</h3>
                        <p class="text-sm text-gray-500 flex items-center" id="modal-email"><i class="fa-solid fa-envelope mr-1 text-xs"></i> ·∫®n danh</p>
                    </div>
                </div>
            </div>
            
            <div class="p-6 space-y-5 bg-white">
                <div class="grid grid-cols-2 gap-y-4 gap-x-2 text-sm border-b border-gray-100 pb-5">
                    <div><span class="text-gray-500 text-xs block uppercase mb-0.5">SƒêT Li√™n H·ªá</span> <span class="font-medium text-gray-800" id="profile-phone">Ch∆∞a c·∫≠p nh·∫≠t</span></div>
                    <div><span class="text-gray-500 text-xs block uppercase mb-0.5">B·∫£o M·∫≠t 2FA</span> <span class="font-medium text-red-500 bg-red-50 px-2 py-0.5 rounded text-xs" id="profile-2fa"><i class="fa-solid fa-shield text-[10px]"></i> T·∫Øt</span></div>
                    <div><span class="text-gray-500 text-xs block uppercase mb-0.5">S·ªë D∆∞ Kh·∫£ D·ª•ng</span> <span class="font-bold text-brand-600 text-base" id="profile-balance">0 ƒë</span></div>
                    <div><span class="text-gray-500 text-xs block uppercase mb-0.5">Tr·∫°ng Th√°i TK</span> <span class="font-medium text-brand-600 bg-green-50 px-2 py-0.5 rounded text-xs" id="profile-status"><i class="fa-solid fa-circle-check text-[10px]"></i> K√≠ch ho·∫°t</span></div>
                    <div class="col-span-2"><span class="text-gray-500 text-xs uppercase mr-2">Ng√†y gia nh·∫≠p:</span> <span class="font-medium text-gray-800" id="profile-created">...</span></div>
                </div>
                
                <form id="form-change-password" class="space-y-3 pt-2">
                    <h4 class="font-bold text-gray-800 text-sm mb-3 flex items-center"><i class="fa-solid fa-key mr-2 text-brand-500"></i> ƒê·ªïi M·∫≠t Kh·∫©u</h4>
                    <div class="relative">
                        <i class="fa-solid fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                        <input type="password" id="old-pass" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i" required class="w-full border border-gray-300 rounded-lg py-2.5 pl-9 pr-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none transition bg-gray-50">
                    </div>
                    <div class="relative">
                        <i class="fa-solid fa-key absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                        <input type="password" id="new-pass" placeholder="M·∫≠t kh·∫©u m·ªõi (T·ªëi thi·ªÉu 6 k√Ω t·ª±)" required minlength="6" class="w-full border border-gray-300 rounded-lg py-2.5 pl-9 pr-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none transition bg-gray-50">
                    </div>
                    <button type="submit" id="btn-change-pass" class="bg-gray-800 hover:bg-black text-white font-medium px-4 py-2.5 rounded-lg text-sm w-full transition shadow-md">L∆∞u M·∫≠t Kh·∫©u</button>
                    <div id="pass-msg" class="text-center mt-2"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- UI JAVASCRIPT & LOGIC ƒê·∫∂T ƒê∆†N (FRONT-END) -->
    <script>
        window.currentPrice = 0;
        window.currentServer = null;
        window.currentServiceCategory = "";

        // 1. T·∫£i danh s√°ch Server theo lo·∫°i D·ªãch v·ª• (B·∫•m t·ª´ menu tr√°i)
        window.loadServiceForm = function(serviceCategory) {
            // Chuy·ªÉn view sang Order
            switchView('order');
            document.getElementById('header-title').innerText = 'Kh·ªüi T·∫°o ƒê∆°n: ' + serviceCategory;
            window.currentServiceCategory = serviceCategory;
            
            // M·ªü kh√≥a √¥ nh·∫≠p li·ªáu
            document.getElementById('order-link').disabled = false;
            document.getElementById('qty').disabled = false;
            
            // ƒê√ÇY L√Ä CH·ªñ B·∫†N C√ì TH·ªÇ TH√äM/S·ª¨A C√ÅC M√ÅY CH·ª¶ (M·ª§C ƒê∆†N)
            let serversData = [];
            if(serviceCategory === 'TƒÉng B√¨nh Lu·∫≠n FB') {
                serversData = [
                    { id: 'sv14', name: 'Server 14 - B√¨nh lu·∫≠n VN ch·∫•t l∆∞·ª£ng cao', price: 1339.5, status: '·ªîn ƒë·ªãnh', tag: 'Khuy√™n d√πng' },
                    { id: 'sv16', name: 'Server 16 - B√¨nh lu·∫≠n VN ng·∫´u nhi√™n', price: 70.3, status: 'Ho·∫°t ƒë·ªông', tag: 'Gi√° r·∫ª' }
                ];
            } else if (serviceCategory === 'TƒÉng Like FB') {
                 serversData = [
                    { id: 'sv1', name: 'Server 1 - Like Vi·ªát si√™u t·ªëc (L√™n ngay)', price: 15, status: 'Nhanh', tag: 'B·∫£o h√†nh' },
                    { id: 'sv2', name: 'Server 2 - Like C·∫£m X√∫c (T√πy ch·ªçn)', price: 20, status: 'Ho·∫°t ƒë·ªông', tag: 'M·ªõi' }
                ];
            } else if (serviceCategory === 'TƒÉng Follow FB') {
                 serversData = [
                    { id: 'sv10', name: 'Server 10 - Sub trang c√° nh√¢n th·∫≠t', price: 120, status: 'Ch·∫≠m', tag: 'Ch·∫•t l∆∞·ª£ng' }
                ];
            }

            const listEl = document.getElementById('server-list');
            listEl.innerHTML = '';
            
            serversData.forEach((sv, index) => {
                const isChecked = index === 0; // M·∫∑c ƒë·ªãnh ch·ªçn c√°i ƒë·∫ßu ti√™n
                if(isChecked) {
                    window.currentPrice = sv.price;
                    window.currentServer = sv;
                }
                
                listEl.innerHTML += `
                    <label class="flex items-start p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-green-50 transition relative ${isChecked ? 'ring-2 ring-brand-500 border-brand-500 bg-green-50' : 'bg-white'}" onclick="selectServer(${sv.price}, '${sv.id}', '${sv.name}', this)">
                        <input type="radio" name="server" class="mt-1 text-brand-600 focus:ring-brand-500 h-4 w-4" ${isChecked ? 'checked' : ''}>
                        <div class="ml-3 flex-1">
                            <div class="text-sm font-bold text-gray-800">${sv.name} <span class="ml-2 bg-red-100 text-red-600 px-2 py-0.5 rounded text-[10px] font-bold uppercase">${sv.tag}</span></div>
                            <div class="mt-2 text-sm">
                                <span class="font-bold text-brand-600 bg-green-100 px-2 py-1 rounded border border-green-200">${sv.price} VNƒê</span>
                                <span class="text-xs text-gray-500 ml-2"><i class="fa-solid fa-signal mr-1"></i>${sv.status}</span>
                            </div>
                        </div>
                    </label>
                `;
            });
            
            // X√≥a th√¥ng b√°o c≈©
            document.getElementById('order-status-msg').classList.add('hidden');
            document.getElementById('qty').value = '';
            calcPrice();
            
            // ƒê√≥ng menu n·∫øu ·ªü Mobile
            if(window.innerWidth < 768) toggleSidebar();
        }

        // 2. Logic khi click ch·ªçn m√°y ch·ªß
        window.selectServer = function(price, id, name, el) {
            window.currentPrice = price;
            window.currentServer = { id: id, name: name, price: price };
            
            // ƒê·ªïi m√†u vi·ªÅn UI
            document.querySelectorAll('#server-list label').forEach(label => {
                label.classList.remove('ring-2', 'ring-brand-500', 'border-brand-500', 'bg-green-50');
                label.classList.add('bg-white');
            });
            el.classList.add('ring-2', 'ring-brand-500', 'border-brand-500', 'bg-green-50');
            el.classList.remove('bg-white');
            
            // T√≠nh l·∫°i ti·ªÅn
            calcPrice();
        }

        // 3. Logic t√≠nh ti·ªÅn v√† b·∫≠t/t·∫Øt n√∫t ƒê·∫∑t H√†ng
        window.calcPrice = function() {
            const qtyStr = document.getElementById('qty').value;
            const qty = parseInt(qtyStr) || 0;
            const total = qty * window.currentPrice;
            
            // Hi·ªÉn th·ªã ti·ªÅn
            document.getElementById('total').innerHTML = `${total.toLocaleString('en-US')} <span class="text-sm text-gray-500">VNƒê</span>`;
            
            // ƒêi·ªÅu khi·ªÉn n√∫t
            const btn = document.getElementById('btn-create-order');
            if (qty > 0 && window.currentServer && qtyStr !== "") {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                btn.classList.add('bg-brand-600', 'hover:bg-brand-700');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'cursor-not-allowed');
                btn.classList.remove('bg-brand-600', 'hover:bg-brand-700');
            }
        }

        // Toggle Sidebar Mobile
        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // Copy STK
        window.copySTK = function() {
            const tempInput = document.createElement('input');
            tempInput.value = '4477040408';
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            const btnIcon = document.getElementById('btn-copy-icon');
            btnIcon.innerHTML = '<i class="fa-solid fa-check text-brand-500 mr-1"></i> ƒê√£ Copy';
            btnIcon.parentElement.classList.replace('text-blue-600', 'text-brand-600');
            setTimeout(() => {
                btnIcon.innerHTML = '<i class="fa-regular fa-copy mr-1"></i> Copy';
                btnIcon.parentElement.classList.replace('text-brand-600', 'text-blue-600');
            }, 2000);
        }

        // C·∫≠p nh·∫≠t QR Code theo s·ªë ti·ªÅn
        window.updateQR = function() {
            const amount = document.getElementById('deposit-amount').value || '';
            const qr = document.getElementById('qr-image');
            qr.src = `https://qr.sepay.vn/img?acc=4477040408&bank=MBBank&amount=${amount}&des=&template=compact`;
        }

        // M·ªü/ƒê√≥ng Modal
        window.toggleModal = function(id) {
            const modal = document.getElementById(id);
            if(modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        // Chuy·ªÉn Tab Giao di·ªán
        window.switchView = function(viewName) {
            // NgƒÉn ch·∫∑n chuy·ªÉn view l·ªãch s·ª≠/ƒë·∫∑t ƒë∆°n n·∫øu menu kh√¥ng ƒë∆∞·ª£c highlight
            if(viewName === 'order' && !window.currentServiceCategory) {
                document.getElementById('header-title').innerText = 'Ch·ªçn D·ªãch V·ª•';
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            const menuBtn = document.getElementById('menu-' + viewName);
            if(menuBtn) menuBtn.classList.add('active');
            
            const titles = {
                'order': window.currentServiceCategory ? ('Kh·ªüi T·∫°o ƒê∆°n: ' + window.currentServiceCategory) : 'Kh·ªüi T·∫°o ƒê∆°n D·ªãch V·ª•',
                'history': 'Qu·∫£n L√Ω L·ªãch S·ª≠ ƒê∆°n',
                'deposit': 'N·∫°p Ti·ªÅn V√†o T√†i Kho·∫£n'
            };
            document.getElementById('header-title').innerText = titles[viewName];

            // Load d·ªØ li·ªáu khi v√†o tab L·ªãch S·ª≠
            if(viewName === 'history' && typeof window.loadOrderHistory === 'function') {
                window.loadOrderHistory();
            }

            // T·ª± ƒë·ªông ƒë√≥ng sidebar tr√™n mobile khi chuy·ªÉn tab
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('sidebar-overlay').classList.add('hidden');
            }
        }
    </script>

    <!-- FIREBASE C·∫§U H√åNH V√Ä DATA LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInAnonymously, EmailAuthProvider, reauthenticateWithCredential, updatePassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, addDoc, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcR0Dl8GYalOIDN5aMoku7wJL-ICS7E2Q",
            authDomain: "flmmo-a4e53.firebaseapp.com",
            projectId: "flmmo-a4e53",
            storageBucket: "flmmo-a4e53.firebasestorage.app",
            messagingSenderId: "973070510202",
            appId: "1:973070510202:web:9eea3a002c0d03d0fbb3c3",
            measurementId: "G-C060Q5CW1E"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Kh·ªüi t·∫°o Auth
        const initAuth = async () => {
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    await signInAnonymously(auth);
                } else {
                    window.currentUserBalance = 0; // L∆∞u t·∫°m s·ªë d∆∞ ƒë·ªÉ tr·ª´ khi ƒë·∫∑t ƒë∆°n
                    loadUserData(user);
                    loadDepositHistory();
                }
            });
        };
        initAuth();

        // 1. T·∫£i D·ªØ Li·ªáu Profile User
        async function loadUserData(user) {
            let displayName = user.displayName || "User";
            let coin = 0;
            let phone = "Ch∆∞a c·∫≠p nh·∫≠t";
            let twoFA = "T·∫Øt";
            let status = "K√≠ch ho·∫°t";
            let createdAt = new Date().toLocaleDateString('vi-VN');

            if (!user.isAnonymous) {
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const data = userDoc.data();
                        displayName = data.fullname || displayName;
                        coin = data.coin || 0;
                        phone = data.phone || phone;
                        twoFA = data.twoFA ? "B·∫≠t" : "T·∫Øt";
                        status = data.status || status;
                        if(data.createdAt) createdAt = new Date(data.createdAt).toLocaleDateString('vi-VN');
                    }
                } catch(e) { console.warn("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu Firestore:", e); }
            } else {
                displayName = "Kh√°ch l·∫° (·∫®n danh)";
            }

            window.currentUserBalance = coin; // G√°n v√†o bi·∫øn global

            // G·∫Øn l√™n UI Header & Sidebar
            document.getElementById('ui-fullname').innerText = displayName;
            document.getElementById('ui-coin').innerText = coin.toLocaleString() + " VNƒê";
            
            const initial = displayName.charAt(0).toUpperCase();
            document.getElementById('ui-avatar').innerText = initial;
            document.getElementById('ui-avatar-small').innerText = initial;
            
            // G·∫Øn l√™n Modal Profile
            document.getElementById('modal-avatar').innerText = initial;
            document.getElementById('modal-name').innerText = displayName;
            document.getElementById('modal-email').innerHTML = `<i class="fa-solid fa-envelope mr-1 text-xs"></i> ${user.email || 'Kh√¥ng c√≥ (T√†i kho·∫£n ·∫©n danh)'}`;
            document.getElementById('profile-phone').innerText = phone;
            document.getElementById('profile-2fa').innerHTML = twoFA === "B·∫≠t" ? `<i class="fa-solid fa-shield text-[10px]"></i> B·∫≠t` : `<i class="fa-solid fa-shield text-[10px]"></i> T·∫Øt`;
            if(twoFA === "B·∫≠t") document.getElementById('profile-2fa').className = "font-medium text-green-600 bg-green-50 px-2 py-0.5 rounded text-xs";
            document.getElementById('profile-balance').innerText = coin.toLocaleString() + " VNƒê";
            document.getElementById('profile-status').innerHTML = status === "K√≠ch ho·∫°t" ? `<i class="fa-solid fa-circle-check text-[10px]"></i> K√≠ch ho·∫°t` : `<i class="fa-solid fa-lock text-[10px]"></i> B·ªã Kh√≥a`;
            if(status !== "K√≠ch ho·∫°t") document.getElementById('profile-status').className = "font-medium text-red-600 bg-red-50 px-2 py-0.5 rounded text-xs";
            document.getElementById('profile-created').innerText = createdAt;
        }

        // ==========================================
        // KHU V·ª∞C LOGIC FIREBASE CHO ƒê·∫∂T ƒê∆†N H√ÄNG
        // ==========================================
        document.getElementById('form-order').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            const btn = document.getElementById('btn-create-order');
            const msg = document.getElementById('order-status-msg');
            
            if(!user || user.isAnonymous) {
                msg.className = "text-sm mt-3 text-center p-3 rounded bg-yellow-50 text-yellow-700 font-medium border border-yellow-200 block";
                msg.innerHTML = '<i class="fa-solid fa-triangle-exclamation mr-1"></i> Vui l√≤ng ƒêƒÉng K√Ω T√†i Kho·∫£n ch√≠nh th·ª©c ƒë·ªÉ t·∫°o ƒë∆°n h√†ng!';
                return;
            }

            const link = document.getElementById('order-link').value;
            const qty = parseInt(document.getElementById('qty').value);
            const totalCost = qty * window.currentPrice;

            // Ki·ªÉm tra s·ªë d∆∞ (T·∫Øt comment ƒëo·∫°n n√†y n·∫øu b·∫°n mu·ªën cho test tho·∫£i m√°i kh√¥ng c·∫ßn ti·ªÅn)
            /*
            if (window.currentUserBalance < totalCost) {
                msg.className = "text-sm mt-3 text-center p-3 rounded bg-red-50 text-red-700 font-medium border border-red-200 block";
                msg.innerHTML = '<i class="fa-solid fa-wallet mr-1"></i> S·ªë d∆∞ c·ªßa b·∫°n kh√¥ng ƒë·ªß ƒë·ªÉ thanh to√°n. Vui l√≤ng n·∫°p th√™m ti·ªÅn!';
                return;
            }
            */

            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> ƒêang x·ª≠ l√Ω...';
            btn.disabled = true;

            try {
                // 1. Th√™m Order v√†o Firestore collection "orders"
                await addDoc(collection(db, "orders"), {
                    uid: user.uid,
                    category: window.currentServiceCategory,
                    serverName: window.currentServer.name,
                    serverId: window.currentServer.id,
                    link: link,
                    quantity: qty,
                    price: window.currentPrice,
                    total: totalCost,
                    status: "ƒêang ch·∫°y",
                    createdAt: new Date().toISOString()
                });

                // 2. Tr·ª´ ti·ªÅn t√†i kho·∫£n (M·ªü comment ra n·∫øu d√πng th·∫≠t)
                /*
                await updateDoc(doc(db, "users", user.uid), {
                    coin: window.currentUserBalance - totalCost
                });
                loadUserData(user); // T·∫£i l·∫°i s·ªë d∆∞ m·ªõi
                */

                msg.className = "text-sm mt-3 text-center p-3 rounded bg-green-50 text-green-700 font-bold border border-green-200 block";
                msg.innerHTML = '<i class="fa-solid fa-check-circle mr-1"></i> T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng! Vui l√≤ng ki·ªÉm tra tab L·ªãch S·ª≠.';
                
                // Chuy·ªÉn h∆∞·ªõng sang trang l·ªãch s·ª≠ sau 2s
                setTimeout(() => {
                    document.getElementById('form-order').reset();
                    msg.classList.add('hidden');
                    window.calcPrice(); // reset price
                    window.switchView('history');
                }, 2000);

            } catch (error) {
                msg.className = "text-sm mt-3 text-center p-3 rounded bg-red-50 text-red-700 font-medium border border-red-200 block";
                msg.innerHTML = '<i class="fa-solid fa-triangle-exclamation mr-1"></i> L·ªói: ' + error.message;
            } finally {
                btn.innerHTML = 'T·∫°o ƒê∆°n H√†ng';
                btn.disabled = false;
            }
        });

        // ==========================================
        // L·∫§Y D·ªÆ LI·ªÜU B·∫¢NG L·ªäCH S·ª¨ ƒê∆†N
        // ==========================================
        window.loadOrderHistory = async function() {
            const user = auth.currentUser;
            if(!user) return;
            const tbody = document.getElementById('order-history-body');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center py-6"><i class="fa-solid fa-circle-notch fa-spin text-gray-400 text-2xl mb-2"></i><br>ƒêang t·∫£i ƒë∆°n h√†ng...</td></tr>';
            
            try {
                const snapshot = await getDocs(collection(db, "orders"));
                let orders = [];
                snapshot.forEach(doc => {
                    if (doc.data().uid === user.uid) {
                        orders.push({ id: doc.id, ...doc.data() });
                    }
                });
                
                // S·∫Øp x·∫øp m·ªõi nh·∫•t l√™n ƒë·∫ßu
                orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                if(orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center py-12 text-gray-500"><i class="fa-solid fa-folder-open text-4xl text-gray-300 mb-3"></i><p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p></td></tr>';
                    return;
                }

                tbody.innerHTML = '';
                orders.forEach(o => {
                    let statusHtml = '';
                    if (o.status === 'ƒêang x·ª≠ l√Ω' || o.status === 'ƒêang ch·∫°y') statusHtml = '<span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-medium border border-blue-200">' + o.status + '</span>';
                    else if (o.status === 'Ho√†n th√†nh') statusHtml = '<span class="bg-brand-100 text-brand-700 px-2 py-1 rounded text-xs font-medium border border-brand-200">Ho√†n th√†nh</span>';
                    else statusHtml = `<span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-medium border border-red-200">${o.status}</span>`;

                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50 transition text-gray-600">
                            <td class="px-4 py-3 text-xs font-mono font-bold">#${o.id.substring(0,8).toUpperCase()}</td>
                            <td class="px-4 py-3 font-medium text-gray-800">${o.category}</td>
                            <td class="px-4 py-3 text-xs"><span class="bg-gray-200 px-2 py-1 rounded-md text-gray-700 font-bold">${o.serverId}</span></td>
                            <td class="px-4 py-3 text-xs max-w-[150px] truncate text-blue-500 hover:text-blue-700 cursor-pointer" title="${o.link}">${o.link}</td>
                            <td class="px-4 py-3 font-bold">${o.quantity.toLocaleString('en-US')}</td>
                            <td class="px-4 py-3 font-bold text-brand-600">${o.total.toLocaleString('en-US')}ƒë</td>
                            <td class="px-4 py-3">${statusHtml}</td>
                        </tr>
                    `;
                });
            } catch(e) {
                tbody.innerHTML = `<tr><td colspan="7" class="text-center py-6 text-red-500"><i class="fa-solid fa-triangle-exclamation mb-2 text-2xl"></i><br>L·ªói t·∫£i l·ªãch s·ª≠ ƒë∆°n: ${e.message}</td></tr>`;
            }
        }

        // ==========================================
        // C√ÅC CH·ª®C NƒÇNG C≈® (N·∫†P TI·ªÄN, ƒê·ªîI MK) GI·ªÆ NGUY√äN
        // ==========================================

        document.getElementById('form-deposit').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if(!user) return;

            const amount = document.getElementById('deposit-amount').value;
            const transId = document.getElementById('deposit-transId').value || '';
            const btn = document.getElementById('btn-submit-deposit');
            const msg = document.getElementById('deposit-status-msg');

            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> ƒêang g·ª≠i l·ªánh...';
            btn.disabled = true;

            try {
                await addDoc(collection(db, "deposits"), {
                    uid: user.uid,
                    amount: parseInt(amount),
                    transId: transId,
                    status: "Ch·ªù Duy·ªát",
                    reason: "",
                    createdAt: new Date().toISOString()
                });
                
                msg.className = "text-sm mt-3 text-center p-3 rounded bg-green-50 text-green-700 font-medium border border-green-100";
                msg.innerHTML = '<i class="fa-solid fa-check-circle mr-1"></i> ƒê√£ g·ª≠i l·ªánh n·∫°p ti·ªÅn. Admin s·∫Ω duy·ªát s·ªõm nh·∫•t!';
                msg.classList.remove('hidden');
                document.getElementById('form-deposit').reset();
                window.updateQR();
                
                loadDepositHistory();
            } catch (error) {
                msg.className = "text-sm mt-3 text-center p-3 rounded bg-red-50 text-red-700 font-medium border border-red-100";
                msg.innerHTML = '<i class="fa-solid fa-triangle-exclamation mr-1"></i> L·ªói: ' + error.message;
                msg.classList.remove('hidden');
            } finally {
                btn.innerHTML = 'T√¥i ƒë√£ chuy·ªÉn ti·ªÅn xong <i class="fa-solid fa-check-circle ml-2"></i>';
                btn.disabled = false;
            }
        });

        window.loadDepositHistory = async function() {
            const user = auth.currentUser;
            if(!user) return;
            const tbody = document.getElementById('deposit-history-body');
            
            try {
                const snapshot = await getDocs(collection(db, "deposits"));
                let deposits = [];
                snapshot.forEach(doc => {
                    if (doc.data().uid === user.uid) deposits.push({ id: doc.id, ...doc.data() });
                });
                deposits.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                if(deposits.length === 0) return;
                tbody.innerHTML = '';
                deposits.forEach(d => {
                    let statusHtml = '';
                    if (d.status === 'Ch·ªù Duy·ªát') statusHtml = '<span class="bg-yellow-100 text-yellow-700 px-2.5 py-1 rounded text-xs font-bold border border-yellow-200">Ch·ªù Duy·ªát</span>';
                    else if (d.status === 'Ch·∫•p Nh·∫≠n') statusHtml = '<span class="bg-brand-100 text-brand-700 px-2.5 py-1 rounded text-xs font-bold border border-brand-200">Ch·∫•p Nh·∫≠n</span>';
                    else statusHtml = `<span class="bg-red-100 text-red-700 px-2.5 py-1 rounded text-xs font-bold border border-red-200">T·ª´ Ch·ªëi</span><div class="text-xs text-red-500 mt-1 italic font-medium"><i class="fa-solid fa-info-circle"></i> ${d.reason || 'Kh√¥ng h·ª£p l·ªá'}</div>`;

                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50 transition">
                            <td class="px-4 py-3 text-sm font-mono text-gray-500">#${d.id.substring(0,6).toUpperCase()}</td>
                            <td class="px-4 py-3 font-bold text-brand-600">${Number(d.amount).toLocaleString('en-US')}ƒë</td>
                            <td class="px-4 py-3 text-sm font-mono text-gray-500">${d.transId || '-'}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">${new Date(d.createdAt).toLocaleString('vi-VN')}</td>
                            <td class="px-4 py-3">${statusHtml}</td>
                        </tr>
                    `;
                });
            } catch(e) {}
        }

        document.getElementById('form-change-password').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            const msg = document.getElementById('pass-msg');
            
            if(!user || user.isAnonymous) {
                msg.innerHTML = '<span class="text-red-500 text-xs font-medium bg-red-50 px-2 py-1 rounded border border-red-100">L·ªói: Vui l√≤ng ƒëƒÉng k√Ω t√†i kho·∫£n ch√≠nh th·ª©c ƒë·ªÉ s·ª≠ d·ª•ng.</span>';
                return;
            }

            const oldPass = document.getElementById('old-pass').value;
            const newPass = document.getElementById('new-pass').value;
            const btn = document.getElementById('btn-change-pass');

            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            btn.disabled = true;

            try {
                const credential = EmailAuthProvider.credential(user.email, oldPass);
                await reauthenticateWithCredential(user, credential);
                await updatePassword(user, newPass);
                
                msg.innerHTML = '<span class="text-green-600 text-sm font-medium"><i class="fa-solid fa-check mr-1"></i> ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!</span>';
                document.getElementById('form-change-password').reset();
            } catch (error) {
                let errText = error.message;
                if(error.code === 'auth/invalid-credential') errText = "M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng!";
                msg.innerHTML = `<span class="text-red-500 text-xs font-medium bg-red-50 px-2 py-1 rounded border border-red-100"><i class="fa-solid fa-triangle-exclamation mr-1"></i> L·ªói: ${errText}</span>`;
            } finally {
                btn.innerHTML = 'L∆∞u M·∫≠t Kh·∫©u';
                btn.disabled = false;
            }
        });

    </script>
</body>
</html>
